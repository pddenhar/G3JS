<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Den Hartog P2</title>

  <script src="gl-matrix.js"></script>
  <script src="bones.js"></script>
  <script src="animation.js"></script>
  <style type="text/css">
    canvas {
        border: 1px solid #d3d3d3;
    }
  </style>
</head>
<body>
Hi<br>
<canvas id="canvas" width="500" height="500"></canvas>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext('2d');

catBaseBone = new bones.imageBone("catBaseBone", null, 'catbase.png', 250/2, 200/2);
catLeyeBone = new bones.imageBone("catLeyeBone", catBaseBone, 'catleye.png', 32, 32);
catReyeBone = new bones.imageBone("catReyeBone", catBaseBone, 'catreye.png', 88/2, 91/2);
catMoufBone = new bones.imageBone("catMoufBone", catBaseBone, 'catmouf.png', 51/2, 41/2);

catBaseBone.pos=[canvas.width/2,canvas.height/2];

catBaseBone.animation = new animation.animation(catBaseBone);
catBaseBone.animation.addKeyframe(0,{pos:[150, canvas.height*.75]});
catBaseBone.animation.addKeyframe(6000,{pos:[canvas.width - 150, canvas.height*.75]});
catBaseBone.animation.addKeyframe(12000,{pos:[150, canvas.height*.75]});

catReyeBone.animation = new animation.animation(catReyeBone);
catReyeBone.animation.addKeyframe(0,{rotation:0});
catReyeBone.animation.addKeyframe(3000,{rotation:-Math.PI *2});

catLeyeBone.animation = new animation.animation(catLeyeBone);
catLeyeBone.animation.addKeyframe(0,{rotation:0});
catLeyeBone.animation.addKeyframe(5000,{rotation:Math.PI *2});

catLeyeBone.pos=[-60, -25];
catReyeBone.pos=[60, -25];
catMoufBone.pos=[0, 25];

var prev = 0;
function loop(timestamp) {
  var delta = prev == 0 ? 0 : (timestamp - prev);
  prev = timestamp;

  ctx.resetTransform();
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  function drawBoneTree(bone, parentTfm){
    if(bone.animation) {
      bone.animation.update(timestamp);
    }
    var t = bone.getTransformWithParentTransform(parentTfm);
    ctx.setTransform(t[0],t[1],t[2],t[3],t[4],t[5]);
    bone.drawToTransformedCtx(ctx);
    for(var key in bone.children) {
      drawBoneTree(bone.children[key], t);
    }
  }
  drawBoneTree(catBaseBone, null);
  window.requestAnimationFrame(loop);
}
loop(0);

</script>
</body>
</html>