<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Den Hartog P2</title>

  <script src="gl-matrix.js"></script>
  <script src="bones.js"></script>
  <style type="text/css">
    canvas {
        border: 1px solid #d3d3d3;
    }
  </style>
</head>
<body>
Hi<br>
<canvas id="canvas" width="500" height="500"></canvas>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext('2d');

catBaseBone = new bones.imageBone("catBaseBone", null, 'catbase.png', 250/2, 200/2);

catLeyeBone = new bones.imageBone("catLeyeBone", catBaseBone, 'catleye.png', 32, 32);

catReyeBone = new bones.imageBone("catReyeBone", catBaseBone, 'catreye.png', 88/2, 91/2);

catMoufBone = new bones.imageBone("catMoufBone", catBaseBone, 'catmouf.png', 51/2, 41/2);

mat2d.translate(catBaseBone.transform, catBaseBone.transform, [canvas.width/2,canvas.height/2])
mat2d.rotate(catBaseBone.transform, catBaseBone.transform, Math.PI / 9)

mat2d.translate(catLeyeBone.transform, catLeyeBone.transform, [-60, -25])
mat2d.translate(catReyeBone.transform, catReyeBone.transform, [60, -25])
mat2d.translate(catMoufBone.transform, catMoufBone.transform, [0, 25])

var prev = 0;
function loop(timestamp) {
  var delta = prev == 0 ? 0 : (timestamp - prev);
  prev = timestamp;
  ctx.resetTransform();
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  function drawBoneTree(bone){
    var t = bone.getTransformWithParent();
    ctx.setTransform(t[0],t[1],t[2],t[3],t[4],t[5]);
    bone.drawToTransformedCtx(ctx);
    for(var key in bone.children) {
      drawBoneTree(bone.children[key]);
    }
  }
  drawBoneTree(catBaseBone);
  window.requestAnimationFrame(loop);
}
loop(0);

</script>
</body>
</html>