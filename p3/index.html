<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Den Hartog P3</title>

  <script src="gl-matrix.js"></script>
  <script src="bones.js"></script>
  <script src="animation.js"></script>
  <style type="text/css">
    canvas {
        border: 1px solid #d3d3d3;
    }
  </style>
</head>
<body>
doot doot<br>
<canvas id="canvas" width="700" height="500"></canvas>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext('2d');
//put 0,0 in the center of the canvas
ctx.setTransform(1, 0, 0, -1, canvas.width / 2, canvas.height / 2);
ctx.beginPath();
ctx.strokeStyle = "black";
ctx.moveTo(-100,0);
ctx.lineTo(100,0);
ctx.stroke();

var chestBone = new bones.wireBone("chestBone", null, 1,1,1);

var projection = mat4.create();
mat4.perspective(projection, Math.PI / 2, canvas.width / canvas.height, 2, 20);

var cameraMatrix = mat4.create();
mat4.lookAt(cameraMatrix, [5,5,5], [0,0,0], [0,1,0])

var prev = 0;
function loop(timestamp) {
  var delta = prev == 0 ? 0 : (timestamp - prev);
  prev = timestamp;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  var transform = mat4.create();
  mat4.multiply(transform, cameraMatrix, transform);
  mat4.multiply(transform, projection, transform);

  function drawBoneTree(bone, parentTfm){
    if(bone.animation) {
      bone.animation.update(timestamp);
    }
    bone.draw(ctx, transform);
    for(var key in bone.children) {
      drawBoneTree(bone.children[key], t);
    }
  }
  drawBoneTree(chestBone, null);

  window.requestAnimationFrame(loop);
}
//loop(0);

</script>
</body>
</html>